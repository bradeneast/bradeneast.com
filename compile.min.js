function getMetaProperty(e,t){return e.split(t+':').pop().split(',')[0].replace(' ','')}function linkify(e){return encodeURI(e.replace(/[^A-Za-z0-9 ]/g,'').toLowerCase()).replace(/%20/g,'-')}function dynamicSort(e){var t=1;return'-'===e[0]&&(t=-1,e=e.substr(1)),function(s,a){return(s[e]<a[e]?-1:s[e]>a[e]?1:0)*t}}function appendMetaTags(e,t){acceptableMetaProperties.map(s=>{if(s=s.toLowerCase(),e.includes(s+':')){const a=getMetaProperty(e,s).replace('/_images/','https://bradeneast.com/_images/');'title'==s&&t(s).text('Braden East | '+a),'description'==s&&t('head').append(`\n<meta name="description" content="${a}">`),t('head').append(`\n<meta property="og:${s}" content="${a}">`)}})}function publishPagesFrom(e){fs.readdirSync(e,{encoding:'utf8'}).map(t=>{if(t.charAt(0)!=ignoreChar)if(fs.lstatSync(e+t).isDirectory())fs.mkdirSync(e.replace('pages','public')+t),publishPagesFrom(e+t+'/');else{const s=e+t,a=e.replace('pages','public')+t,r=cheerio.load(htmlParser.parseDOM(fs.readFileSync(pageTemplate))),o=htmlParser.parseDOM(fs.readFileSync(s),{decodeEntities:!0});r('#main').append(o),o[0]&&appendMetaTags(o[0].data,r),fs.createFileSync(a),fs.writeFileSync(a,r.html().replace(/(<!--)[\s\S]*?(-->)/g,'')),console.log('page written to '+a)}})}function addPostToRSS(e){let t,s=new Date(e.date);e.tags.split(', ').map(e=>t+=`<category>${e}</category>`),RSSFeedContent+=`\n        <item>\n        <title>${e.title}</title>\n        <link>https://bradeneast.com/blog/${e.link}</link>\n        <guid>https://bradeneast.com/blog/${e.link}</guid>\n        <pubDate>${s.toUTCString()}</pubDate>\n        ${t}\n        <description>${e.body.substr(0,e.body.indexOf('</p>')+4).replace(/<[^>]*>/g,'')}</description>\n        </item>`}function createPostFeed(e,t,s){const a=htmlParser.parseDOM(fs.readFileSync(t),{decodeEntities:!0}),r=cheerio.load(a),o=r('#postFeed');o.children().not('template').remove(),e.map(e=>{(!s||e.tags.join().includes(s))&&addPostToFeed(e,o,r)}),fs.writeFileSync(t,String(r.html()).replace(/\n\s*\n/g,'\n'))}function addPostToFeed(e,t,s){const a=s('template').contents().clone();Object.keys(e).map(t=>{let s=a.find(`.${t}`),r=e[t];t=t.toLowerCase(),Array.isArray(r)&&(r=r.join(', ')),s&&('body'==t?s.append(r.substr(0,r.indexOf('</p>')+4)):'link'==t?s.attr('href',r):'image'==t?s.attr('src',r):s.append(r))}),t.append(a)}function readyPostData(e,t){let s={title:'',date:'',tags:[],body:'',link:'',image:''};if(e){const a=new commonmark.Parser({smart:!0}),r=new commonmark.HtmlRenderer({softbreak:'<br />'}),o=a.parse(fs.readFileSync(t+e,'utf8')),n=htmlParser.parseDOM(r.render(o),{decodeEntities:!0}),i=cheerio.load(n);i('code').each(function(e,t){const s=i(this).text();'language-html'==t.attribs.class&&i(this).empty().append(prism.highlight(s,prism.languages.markup)),'language-javascript'==t.attribs.class&&i(this).empty().append(prism.highlight(s,prism.languages.javascript)),'language-css'==t.attribs.class&&i(this).empty().append(prism.highlight(s,prism.languages.css))}),s.title=i('h1').contents().text(),s.date=i('h2').contents().text(),s.tags=i('h3').contents().text(),s.image=i('img').attr('src'),s.body=String(i.html()).replace(/<h1>.*?<\/h3>/gis,''),t==blogPostSrc&&(s.link='/blog/'+linkify(s.title),s.tags.split(', ').map(e=>blogTags.push(e)),blogPosts.push(s),s.body+=`<p>Thanks for reading! If you learned something useful, <a target="_blank" href="https://twitter.com/share?text=${s.link.replace(/\/blog\/|-/gi,'%20')}%20by%20@bradenthehair%20-%20&url=https://bradeneast.com/blog/${s.link}">share this article</a> with your followers. I appreciate it!</p>`),t==workPostSrc&&(s.link='/work/'+linkify(s.title),s.tags.split(', ').map(e=>workTags.push(e)),workPosts.push(s))}}function createNewPostsFromTemplate(e,t){e.map((s,a)=>{const r=public+s.link+'/index.html',o=cheerio.load(htmlParser.parseDOM(fs.readFileSync(pageTemplate),{decodeEntities:!0}));o('#main').append(htmlParser.parseDOM(fs.readFileSync(postTemplate))),appendMetaTags(`<!--title: ${s.title}, description: ${s.body.substr(0,50)},-->`,o),fs.mkdirSync(r.replace('/index.html','')),Object.keys(s).map(e=>{let a=o(`.${e}`),r=s[e];if('tags'==e){const e=[];r.split(', ').map(s=>{e.push(`\n                        <a href="/${t.replace(public,'')}tags/${encodeURI(s).replace(/%20+/g,'-')}">\n                            ${s}\n                        </a>\n                    `)}),r=e.join(', ')}'image'==e?a.attr('src',r):r&&a&&a.append(r)});const n=e[a-1],i=o('.previous'),l=e[a+1],p=o('.next');n?(i.find('.link-title').append(n.title),i.attr('href',`${n.link}`)):i.attr('style','display: none'),l?(p.find('.link-title').append(l.title),p.attr('href',`${l.link}`)):p.attr('style','display: none'),addPostToRSS(s),fs.writeFileSync(r,o.html()),console.log('post written to '+r)})}function buildTagDirectories(e,t){fs.mkdirSync(`${t}tags`),[...new Set(e)].map(e=>{const s=encodeURI(e).replace(/\%20+/g,'-'),a=`${t}tags/${s}/index.html`;fs.mkdirSync(a.split('/index.html').shift()),fs.copyFileSync(pageTemplate,a);const r=cheerio.load(htmlParser.parseDOM(fs.readFileSync(pageTemplate),{decodeEntities:!0}));r('#main').prepend(htmlParser.parseDOM(fs.readFileSync(`${postsFolder}_tags.html`),{decodeEntities:!0})),r('.tagName').each(function(){r(this).append(e)}),t==blog&&blogPosts.map(t=>t.tags.includes(e)?addPostToFeed(t,r('#postFeed'),r):null),t==work&&workPosts.map(t=>t.tags.includes(e)?addPostToFeed(t,r('#postFeed'),r):null),fs.writeFileSync(a,r.html()),console.log(`tag directory created for ${e}`)})}console.time('\n>> SITE COMPILED IN');const fs=require('fs-extra'),htmlParser=require('htmlParser2'),cheerio=require('cheerio'),commonmark=require('commonmark'),prism=require('prismjs'),ignoreChar='_',public='./public/',blog=public+'blog/',work=public+'work/',pageTemplate='./_template.html',pagesFolder='./pages/',postsFolder='./posts/',blogPostSrc=postsFolder+'_blog/',workPostSrc=postsFolder+'_work/',postTemplate=postsFolder+'_template.html',acceptableMetaProperties=['title','description','image'],RSSFeed='feed.xml',RSSLink='https://www.bradeneast.com/blog/feed.xml',today=new Date;let RSSFeedContent=`<?xml version="1.0" encoding="utf-8"?>\n<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/">\n<channel>\n<title>Blog of Braden East</title>\n<link>${RSSLink}</link>\n<description>The blog for design-oriented devs. Get regular tips to improve your UI and UX design skills.</description>\n<lastBuildDate>${today.toUTCString()}</lastBuildDate>\n<atom:link href="${RSSLink}" rel="self" type="application/rss+xml" />`,blogPosts=[],blogTags=[],workPosts=[],workTags=[];fs.cleandirSync=function(e){fs.readdirSync(e).map(t=>t.charAt(0)!=ignoreChar?fs.removeSync(e+t):null)},fs.cleandirSync(public,ignoreChar),publishPagesFrom('./pages/'),fs.cleandirSync(postsFolder),fs.createFileSync(blog+RSSFeed),fs.readdirSync(blogPostSrc).map(e=>readyPostData(e,blogPostSrc)),blogPosts.sort(dynamicSort('date')).reverse(),createNewPostsFromTemplate(blogPosts,blog),createPostFeed(blogPosts,`${public}blog/index.html`),buildTagDirectories(blogTags,blog),fs.writeFileSync(blog+RSSFeed,`${RSSFeedContent}</channel></rss>`),fs.readdirSync(workPostSrc).map(e=>readyPostData(e,workPostSrc)),workPosts.sort(dynamicSort('date')).reverse(),createNewPostsFromTemplate(workPosts,work),createPostFeed(workPosts,`${public}work/index.html`),buildTagDirectories(workTags,work),console.timeEnd('\n>> SITE COMPILED IN'),console.log('\n');